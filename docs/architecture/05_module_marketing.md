# ğŸ“£ è¥é”€æ¨¡å—è®¾è®¡æ–‡æ¡£ï¼ˆMarketing Moduleï¼‰ - CRM Lite

## ğŸ“Œ æ¨¡å—ç›®æ ‡

è¥é”€æ¨¡å—æ—¨åœ¨æ”¯æŒåŸºäºå®¢æˆ·ç”»åƒè¿›è¡Œä¸»åŠ¨è§¦è¾¾ã€ä¼˜æƒ æ´»åŠ¨ç®¡ç†ã€ä»¥åŠå®¢æˆ·è¿è¥æ•°æ®è¿½è¸ªã€‚å…¶æ ¸å¿ƒèƒ½åŠ›åŒ…æ‹¬è¥é”€æ´»åŠ¨åˆ›å»ºã€ç›®æ ‡å®¢æˆ·ç­›é€‰ã€è¥é”€è®°å½•å­˜å‚¨ä¸ç»“æœè¿½è¸ªã€‚

---

## ğŸ§± æ•°æ®æ¨¡å‹è®¾è®¡

### è¥é”€æ´»åŠ¨è¡¨ï¼ˆmarketing_campaignï¼‰

| å­—æ®µå       | ç±»å‹       | æè¿°                       |
|--------------|------------|----------------------------|
| `id`         | UUID       | æ´»åŠ¨å”¯ä¸€æ ‡è¯†               |
| `name`       | string     | æ´»åŠ¨åç§°                   |
| `type`       | string     | æ´»åŠ¨ç±»å‹ï¼ˆå¦‚ `sms`, `email`, `push_notification`ï¼‰   |
| `status`     | string     | æ´»åŠ¨çŠ¶æ€ï¼ˆå¦‚ `draft`, `scheduled`, `active`, `completed`, `archived`ï¼‰|
| `target_tags`| []string   | ç›®æ ‡å®¢æˆ·æ ‡ç­¾ (JSONB or array) |
| `target_segment_id` | UUID    | ç›®æ ‡å®¢æˆ·åˆ†ç¾¤ID (å¯é€‰, æ›´å¤æ‚çš„ç›®æ ‡ç¾¤ä½“) |
| `content_template_id` | UUID | å†…å®¹æ¨¡æ¿ID (å¯é€‰, ç”¨äºä¸ªæ€§åŒ–æ¶ˆæ¯) |
| `content`    | text       | æ´»åŠ¨å…·ä½“å†…å®¹æˆ–æ¨¡æ¿å˜é‡çš„JSONæ•°æ® |
| `start_time` | datetime   | è®¡åˆ’å¯åŠ¨æ—¶é—´                   |
| `end_time`   | datetime   | è®¡åˆ’ç»“æŸæ—¶é—´                   |
| `actual_start_time` | datetime | å®é™…å¯åŠ¨æ—¶é—´ (å¯é€‰) |
| `actual_end_time` | datetime | å®é™…ç»“æŸæ—¶é—´ (å¯é€‰) |
| `created_by` | UUID       | åˆ›å»ºäººID |
| `updated_by` | UUID       | æœ€åä¿®æ”¹äººID |
| `created_at` | datetime   | åˆ›å»ºæ—¶é—´                   |
| `updated_at` | datetime   | æ›´æ–°æ—¶é—´                   |

### è¥é”€è§¦è¾¾è®°å½•è¡¨ï¼ˆmarketing_recordï¼‰

| å­—æ®µå        | ç±»å‹     | æè¿°                         |
|---------------|----------|------------------------------|
| `id`          | UUID     | å”¯ä¸€æ ‡è¯†                     |
| `campaign_id` | UUID     | å…³è”çš„è¥é”€æ´»åŠ¨ID             |
| `customer_id` | UUID     | è¢«è§¦è¾¾å®¢æˆ·ID                 |
| `channel`     | string   | è§¦è¾¾æ¸ é“ (å¦‚ `sms`, `email`) |
| `status`      | string   | å‘é€çŠ¶æ€ï¼ˆå¦‚ `pending`, `sent`, `delivered`, `failed`, `opened`, `clicked`ï¼‰        |
| `error_message`| string  | å‘é€å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯ (å¯é€‰) |
| `response`    | jsonb    | å®¢æˆ·åé¦ˆæˆ–äº’åŠ¨æ•°æ®ï¼ˆå¦‚ï¼š`{"action": "click", "link_id": "promo123"}`ï¼Œå¯ä½¿ç”¨ JSONB ç±»å‹å­˜å‚¨çµæ´»ç»“æ„ï¼‰      |
| `sent_at`     | datetime | å®é™…å‘é€æ—¶é—´                     |
| `opened_at`   | datetime | æ‰“å¼€æ—¶é—´ (é‚®ä»¶/æ¨é€å¯é€‰) |
| `clicked_at`  | datetime | ç‚¹å‡»æ—¶é—´ (é‚®ä»¶/çŸ­ä¿¡é“¾æ¥å¯é€‰) |

---

## ğŸ“‚ æ¨¡å—ç›®å½•ç»“æ„å»ºè®®

internal/marketing/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ marketing_controller.go
â”œâ”€â”€ service/
â”‚   â””â”€â”€ marketing_service.go
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ marketing_campaign.go
â”‚   â””â”€â”€ marketing_record.go
â”œâ”€â”€ router/
â”‚   â””â”€â”€ marketing_router.go

---

## ğŸ”Œ æ¥å£è®¾è®¡

### è¥é”€æ´»åŠ¨ (Campaigns)

#### POST `/api/marketing/campaigns`

- æè¿°ï¼šæ–°å»ºè¥é”€æ´»åŠ¨ã€‚
- è¯·æ±‚ä½“ (JSON):

```json
{
  "name": "å…­æœˆä¼šå‘˜å…³æ€€çŸ­ä¿¡",
  "type": "sms",
  "target_tags": ["VIP", "æ–°ç”¨æˆ·"],
  // "target_segment_id": "segment-uuid", // å¯é€‰
  "content": "äº²çˆ±çš„[å®¢æˆ·å§“å]ï¼Œæ‚¨æœ‰ä¸€ä»½6æœˆä¸“å±å¥½ç¤¼å¾…é¢†å–ï¼è¯¦æƒ…è¯·è®¿é—®[é“¾æ¥]ã€‚é€€è®¢è¯·å›å¤TDã€‚",
  // "content_template_id": "template-uuid", // å¯é€‰ï¼Œå¦‚æœä½¿ç”¨æ¨¡æ¿
  "start_time": "2024-06-10T09:00:00Z",
  "end_time": "2024-06-15T23:59:59Z"
}
```

- è¿”å›ï¼šæˆåŠŸæ—¶è¿”å›æ–°åˆ›å»ºçš„è¥é”€æ´»åŠ¨è¯¦æƒ…ã€‚

```json
{
  "id": "campaign-uuid",
  "name": "å…­æœˆä¼šå‘˜å…³æ€€çŸ­ä¿¡",
  "type": "sms",
  "status": "draft", // æˆ– "scheduled" å¦‚æœ start_time æ˜¯æœªæ¥
  // ... å…¶ä»–å­—æ®µ
  "created_at": "2024-06-01T10:00:00Z"
}
```

#### GET `/api/marketing/campaigns`

- æè¿°ï¼šåˆ†é¡µè·å–è¥é”€æ´»åŠ¨åˆ—è¡¨ã€‚
- è¯·æ±‚å‚æ•°ï¼š
  - `status` (string, å¯é€‰)ï¼šæŒ‰æ´»åŠ¨çŠ¶æ€ç­›é€‰ã€‚
  - `type` (string, å¯é€‰)ï¼šæŒ‰æ´»åŠ¨ç±»å‹ç­›é€‰ã€‚
  - `name` (string, å¯é€‰): æŒ‰æ´»åŠ¨åç§°æ¨¡ç³Šæœç´¢ã€‚
  - `page` (int, å¯é€‰)ï¼šé¡µç ã€‚
  - `page_size` (int, å¯é€‰)ï¼šæ¯é¡µæ•°é‡ã€‚
- è¿”å›ï¼š

```json
{
  "campaigns": [
    {
      "id": "campaign-uuid-1",
      "name": "å…­æœˆä¼šå‘˜å…³æ€€çŸ­ä¿¡",
      "type": "sms",
      "status": "active",
      "start_time": "2024-06-10T09:00:00Z",
      "end_time": "2024-06-15T23:59:59Z"
    }
  ],
  "pagination": {
    "total": 25,
    "page": 1,
    "page_size": 10
  }
}
```

#### GET `/api/marketing/campaigns/:id`

- æè¿°ï¼šè·å–æŒ‡å®šè¥é”€æ´»åŠ¨çš„è¯¦ç»†ä¿¡æ¯ã€‚
- è¯·æ±‚å‚æ•°ï¼šæ— 
- è¿”å›ï¼šå•ä¸ªè¥é”€æ´»åŠ¨è¯¦æƒ…ï¼Œç»“æ„ç±»ä¼¼ `POST /api/marketing/campaigns` çš„æˆåŠŸå“åº”ã€‚

#### PUT `/api/marketing/campaigns/:id`

- æè¿°ï¼šæ›´æ–°è¥é”€æ´»åŠ¨ä¿¡æ¯ï¼ˆé€šå¸¸åœ¨æ´»åŠ¨æœªå¼€å§‹å‰å…è®¸ä¿®æ”¹ï¼‰ã€‚
- è¯·æ±‚ä½“ (JSON)ï¼šåŒ…å«éœ€è¦æ›´æ–°çš„å­—æ®µï¼Œç»“æ„ç±»ä¼¼åˆ›å»ºè¯·æ±‚ã€‚
- è¿”å›ï¼šæˆåŠŸæ—¶è¿”å›æ›´æ–°åçš„è¥é”€æ´»åŠ¨è¯¦æƒ…ã€‚

#### POST `/api/marketing/campaigns/:id/trigger`

- æè¿°ï¼šæ‰‹åŠ¨è§¦å‘è¥é”€æ´»åŠ¨æ‰§è¡Œï¼ˆä¾‹å¦‚ï¼Œå¯¹äºéå®šæ—¶æ´»åŠ¨ï¼Œæˆ–éœ€è¦ç«‹å³æ‰§è¡Œçš„åœºæ™¯ï¼‰ã€‚å¯¹äºå·²è®¾å®š `start_time` çš„æ´»åŠ¨ï¼Œé€šå¸¸ç”±è°ƒåº¦å™¨è‡ªåŠ¨è§¦å‘ã€‚
- è¯·æ±‚ä½“ (JSON, å¯é€‰)ï¼š

```json
{
  "execution_type": "actual" // "actual" æˆ– "simulation"
}
```

- è¿”å›ï¼š

```json
{
  "status": "triggered", // æˆ– "simulation_started"
  "message": "è¥é”€æ´»åŠ¨å·²æˆåŠŸè§¦å‘æ‰§è¡Œã€‚",
  "execution_id": "exec-uuid" // å¯é€‰ï¼Œç”¨äºè¿½è¸ªæœ¬æ¬¡æ‰§è¡Œ
}
```

#### POST `/api/marketing/campaigns/:id/archive`

- æè¿°ï¼šå½’æ¡£è¥é”€æ´»åŠ¨ã€‚
- è¯·æ±‚å‚æ•°ï¼šæ— 
- è¿”å›ï¼šæˆåŠŸä¿¡æ¯æˆ–æ›´æ–°åçš„æ´»åŠ¨çŠ¶æ€ã€‚

### è¥é”€è§¦è¾¾è®°å½• (Records)

#### GET `/api/marketing/records`

- æè¿°ï¼šæŸ¥è¯¢è¥é”€æ´»åŠ¨çš„å®¢æˆ·è§¦è¾¾è®°å½•ä¸åé¦ˆæƒ…å†µã€‚
- è¯·æ±‚å‚æ•°ï¼š
  - `campaign_id` (string, å¿…é€‰)ï¼šå…³è”çš„è¥é”€æ´»åŠ¨IDã€‚
  - `customer_id` (string, å¯é€‰)ï¼šæŒ‰å®¢æˆ·IDç­›é€‰ã€‚
  - `status` (string, å¯é€‰)ï¼šæŒ‰å‘é€çŠ¶æ€ç­›é€‰ã€‚
  - `channel` (string, å¯é€‰): æŒ‰è§¦è¾¾æ¸ é“ç­›é€‰ã€‚
  - `page` (int, å¯é€‰)ï¼šé¡µç ã€‚
  - `page_size` (int, å¯é€‰)ï¼šæ¯é¡µæ•°é‡ã€‚
- è¿”å›ï¼š

```json
{
  "records": [
    {
      "id": "record-uuid-1",
      "campaign_id": "campaign-uuid-1",
      "customer_id": "customer-uuid-123",
      "channel": "sms",
      "status": "delivered",
      "sent_at": "2024-06-10T09:05:00Z",
      "response": null
    },
    {
      "id": "record-uuid-2",
      "campaign_id": "campaign-uuid-1",
      "customer_id": "customer-uuid-456",
      "channel": "sms",
      "status": "clicked",
      "sent_at": "2024-06-10T09:06:00Z",
      "response": {"action": "click", "link_id": "promo_link"},
      "clicked_at": "2024-06-10T10:15:00Z"
    }
  ],
  "pagination": {
    "total": 1500,
    "page": 1,
    "page_size": 50
  }
}
```

---

### ğŸ“ˆ æˆæ•ˆè¯„ä¼°å»ºè®®

- **è§¦è¾¾ç‡æŒ‡æ ‡**ï¼š
  - è®¡åˆ’è§¦è¾¾æ•° vs å®é™…å°è¯•å‘é€æ•°
  - å‘é€æˆåŠŸç‡ï¼ˆ`sent` / å°è¯•å‘é€æ•°ï¼‰
  - é€è¾¾æˆåŠŸç‡ï¼ˆ`delivered` / `sent`ï¼‰
- **äº’åŠ¨ç‡æŒ‡æ ‡** (æ ¹æ®æ¸ é“å’Œå†…å®¹è®¾è®¡)ï¼š
  - æ‰“å¼€ç‡ï¼ˆ`opened` / `delivered`ï¼‰ï¼Œä¸»è¦ç”¨äºé‚®ä»¶ã€æ¨é€
  - ç‚¹å‡»ç‡ï¼ˆ`clicked` / `delivered` æˆ– `opened`ï¼‰
  - è½¬åŒ–ç‡ï¼ˆå®Œæˆç›®æ ‡è¡Œä¸ºæ•° / `delivered` æˆ– `clicked`ï¼‰ï¼Œéœ€ç»“åˆä¸šåŠ¡ç›®æ ‡å®šä¹‰
- **æˆæœ¬æ•ˆç›Šåˆ†æ**ï¼šæ´»åŠ¨æˆæœ¬ vs å¸¦æ¥çš„æ”¶ç›Šï¼ˆå¦‚è®¢å•å¢åŠ ã€å®¢æˆ·æ´»è·ƒåº¦æå‡ï¼‰ã€‚
- å¯é€šè¿‡ A/B æµ‹è¯•ä¸åŒè¥é”€å†…å®¹ã€ç›®æ ‡ç¾¤ä½“ã€å‘é€æ—¶é—´ç­‰ï¼Œä¼˜åŒ–è¥é”€æ•ˆæœã€‚

---

### ğŸ’¡ æ‰©å±•å»ºè®®

- **æ¨¡æ¿åŒ–ä¸ä¸ªæ€§åŒ–**ï¼š
  - æ”¯æŒæ¶ˆæ¯æ¨¡æ¿ç®¡ç†ï¼Œå…è®¸åŠ¨æ€æ’å…¥å®¢æˆ·å˜é‡ï¼ˆå¦‚å§“åã€æœ€è¿‘è´­ä¹°å•†å“ç­‰ï¼‰ã€‚
  - åˆ©ç”¨å®¢æˆ·ç”»åƒå’Œè¡Œä¸ºæ•°æ®ï¼Œå®ç°åƒäººåƒé¢çš„ä¸ªæ€§åŒ–è¥é”€å†…å®¹æ¨èã€‚
- **å¤šæ¸ é“æ•´åˆ**ï¼š
  - æ— ç¼å¯¹æ¥çŸ­ä¿¡ã€é‚®ä»¶ã€App Pushã€ç¤¾äº¤åª’ä½“ï¼ˆå¦‚å¾®ä¿¡å…¬ä¼—å·/å°ç¨‹åºæ¶ˆæ¯ï¼‰ç­‰å¤šç§è¥é”€æ¸ é“ã€‚
  - ç»Ÿä¸€ç®¡ç†å®¢æˆ·åœ¨å„æ¸ é“çš„è¥é”€åå¥½å’Œç¦æ­¢æ‰“æ‰°è®¾ç½® (Opt-out)ã€‚
- **è‡ªåŠ¨åŒ–ä¸æ™ºèƒ½åŒ–**ï¼š
  - ç»“åˆä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼ˆå¦‚ Cron Jobï¼‰å®ç°å®šæ—¶ã€å‘¨æœŸæ€§æˆ–äº‹ä»¶è§¦å‘å¼è¥é”€æ´»åŠ¨ï¼ˆä¾‹å¦‚ï¼Œå®¢æˆ·ç”Ÿæ—¥ç¥ç¦ã€æµå¤±é¢„è­¦å…³æ€€ï¼‰ã€‚
  - åˆ©ç”¨å®¢æˆ·åˆ†ç¾¤ (Segmentation) å’Œå®¢æˆ·æ—…ç¨‹ (Customer Journey) è®¾è®¡ï¼Œå®ç°è‡ªåŠ¨åŒ–è¥é”€æµç¨‹ã€‚
  - å¼•å…¥ç®€å•çš„è§„åˆ™å¼•æ“æˆ– AI ç®—æ³•ï¼Œè¿›è¡Œè¥é”€æ—¶æœºå’Œå†…å®¹æ¨èã€‚
- **åˆè§„æ€§ä¸ç”¨æˆ·ä½“éªŒ**ï¼š
  - ä¸¥æ ¼éµå®ˆå„å›½å…³äºè¥é”€æ¶ˆæ¯å‘é€çš„æ³•è§„ï¼ˆå¦‚ GDPR, CCPAï¼‰ï¼Œæä¾›æ˜ç¡®çš„é€€è®¢æœºåˆ¶ã€‚
  - æ§åˆ¶è¥é”€é¢‘ç‡ï¼Œé¿å…è¿‡åº¦æ‰“æ‰°ç”¨æˆ·ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
